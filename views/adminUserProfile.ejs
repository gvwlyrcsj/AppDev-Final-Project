<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Sidebar Styling */
    .sidebar {
      flex: 0 0 250px; /* Flex property to allow resizing */
      height: 160vh;
      background-color: #343a40;
      color: #fff;
      padding-top: 20px;
    }
    .sidebar .nav-link {
      color: #ddd;
      margin-bottom: 10px;
    }
    .content {
      flex-grow: 1; /* Flex property to take the remaining space */
      padding: 40px;
    }
    .sidebar img {
      width: 100px;
      height: 100px;
      object-fit: cover;
    }
    .d-flex {
      min-height: 100vh; /* Ensure the container takes up the full height of the viewport */
    }
    .profile-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    .profile-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .profile-header h1 {
      font-size: 2rem;
    }
    .profile-header p {
      font-size: 1.2rem;
    }
    .profile-header img {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
    }
    .form-group {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="text-center mb-3">
        <img src="img/logo.png" alt="Logo">
      </div>
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link" href="/admin">Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/manageProduct">Manage Products</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/orders">Orders</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/report">Report</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/feedback">Feedback</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/userProfile">Profile</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/manageAdmin">Manage Admin</a>
        </li>
      </ul>
    </nav>

    <!-- Main Content -->
    <div class="content">
      <div class="profile-container">
        <div class="profile-header">
          <h1>Edit Profile</h1>
          <p>Update your account settings</p>
        </div>

        <div class="text-center mb-4">
          <img src="<%= profile.profile_picture || '/path/to/default-picture.jpg' %>" alt="Profile Picture">
        </div>

        <form action="/userProfile/upsert" method="post" enctype="multipart/form-data">
          <input type="hidden" name="userId" value="<%= user.id %>">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="profile_picture">Profile Picture:</label>
                <input type="file" class="form-control" name="profile_picture" id="profile_picture" accept="image/*">
              </div>

              <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" class="form-control" name="username" id="username" value="<%= user.username %>" required>
              </div>

              <div class="form-group">
                <label for="name">Name:</label>
                <input type="text" class="form-control" name="name" id="name" value="<%= profile.name || '' %>">
              </div>

              <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" name="email" id="email" value="<%= user.email %>" required>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="birthday">Birthday:</label>
                <input type="date" class="form-control" name="birthday" id="birthday" value="<%= profile.birthday ? profile.birthday.toISOString().split('T')[0] : '' %>" required onchange="calculateAge()">
              </div>

              <div class="form-group">
                <label for="age">Age:</label>
                <input type="text" class="form-control" name="age" id="age" value="<%= profile.age || '' %>" readonly>
              </div>

              <div class="form-group">
                <label for="phone">Phone:</label>
                <input type="tel" class="form-control" name="phone" id="phone" value="<%= profile.phone || '' %>">
              </div>

              <div class="form-group">
                <label for="gender">Gender:</label>
                <select class="form-control" name="gender" id="gender">
                  <option value="" disabled selected>Select your gender</option>
                  <option value="Male" <%= profile.gender === 'Male' ? 'selected' : '' %>>Male</option>
                  <option value="Female" <%= profile.gender === 'Female' ? 'selected' : '' %>>Female</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="street_name">Street Name:</label>
                <input type="text" class="form-control" name="street_name" id="street_name" value="<%= profile.street_name || '' %>">
              </div>

              <div class="form-group">
                <label for="city">City:</label>
                <select class="form-control" name="city" id="city" required>
                  <option value="" disabled selected>Select your city</option>
                  <option value="calapan" <%= profile.city === 'calapan' ? 'selected' : '' %>>Calapan</option>
                  <!-- Add other cities as necessary -->
                </select>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-group">
                <label for="barangay">Barangay:</label>
                <select class="form-control" name="barangay" id="barangay" required>
                  <option value="" disabled>Select your barangay</option>
                  <% if (barangays[profile.city]) { %>
                      <% barangays[profile.city].forEach((b) => { %>
                          <option value="<%= b %>" <%= b === profile.barangay ? 'selected' : '' %>><%= b %></option>
                      <% }) %>
                  <% } %>
                </select>
              </div>

              <div class="form-group">
                <label for="zip_code">Zip Code:</label>
                <input type="text" class="form-control" name="zip_code" id="zip_code" value="<%= profile.zip_code || '' %>">
              </div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary btn-block">Save Profile</button>
        </form>
      </div>
    </div>
  </div>
<script>
    const barangays = {
        calapan: ["Balingayan", "Balite", "Baruyan", "Batino", "Bayanan I", "Bayanan II", "Biga", "Bondoc", "Bucayao",
            "Buhuan", "Bulusan", "Calero", "Camansihan", "Camilmil", "Canubing I", "Canubing II", "Comunal",
            "Guinobatan", "Gulod", "Gutad", "Ibaba East", "Ibaba West", "Ilaya", "Lalud", "Lazareto", "Libis",
            "Lumangbayan", "Mahal Na Pangalan", "Maidlang", "Malad", "Malamig", "Managpi", "Masipit", "Nag-Iba I",
            "Nag-Iba II", "Navotas", "Pachoca", "Palhi", "Panggalaan", "Parang", "Patas", "Personas", "Puting Tubig",
            "San Antonio", "San Rafael (formerly Salong)", "San Vicente Central", "San Vicente East", "San Vicente North",
            "San Vicente South", "San Vicente West", "Sapul", "Silonay", "Santa Cruz", "Santa Isabel", "Santa Maria Village",
            "Santa Rita", "Santo Niño", "Suqui", "Tawagan", "Tawiran", "Tibag", "Wawa"],
        baco: ["Alag", "Bangkatan", "Baras (Mangyan Minority)", "Bayanan", "Burbuli", "Dulangan I", "Dulangan II", 
            "Katuwiran I", "Katuwiran II", "Lantuyang (Mangyan Minority)", "Lumangbayan", "Malapad", "Mangangan I", 
            "Mangangan II", "Mayabig", "Pambisan", "Poblacion", "Pulantubig", "PuticanCabulo", "San Andres", 
            "San Ignacio", "Santa Cruz", "Santa Rosa I", "Santa Rosa II", "TabonTabon", "Tagumpay", "Water"],
        bansud: ["Antipolo", "Aras-asan", "Bagumbayan", "Balay", "Bayan ng Bansud", "Cabangahan", "Dampulan", 
            "Kalingatan", "Mababang Bato", "Magsaysay", "Managpi", "Napangan", "Pabilaan", "Poblacion", "Tagumpay"],
        bongabong: ["Alag", "Bagumbayan", "Balay", "Bayanan", "Bignay", "Bongabong Proper", "Lalud", 
            "Masaguitsit", "Marayag", "Mabanglas", "Mangyan", "Malunod", "Palhuan", "Poblacion", "San Isidro", "San Jose"],
        bulalacao: ["Balcasan", "Bamboo", "Buli", "Bulalacao", "Dawis", "Dela Paz", "Gintong Silangan", 
            "Hindang", "Ibayug", "Kalapagan", "Katribo", "Lamon", "Libas", "Lunhaw", "Mapagkumbaba", "Nag-iba", "Poblacion"],
        mansalay: ["Bagumbayan", "Bansud", "Bongabong", "Bubog", "Caguya", "Canas", "Canubing", "Dumantay", 
            "Gulod", "Mansalay", "Mapagkumbaba", "Poblacion", "San Antonio", "San Isidro"],
        naujan: ["Bagumbayan", "Bangas", "Barangan", "Buhay", "Dugay", "Isabang", "Ibabang I", "Ibabang II", 
            "Lagan", "Lapidan", "Maguin", "Marayag", "Mauway", "Muntinlupa", "Poblacion", "Punduhan"],
        pinamalayan: ["Bagong Silang", "Bagumbayan", "Bansud", "Bongabong", "Calapan", "Calavite", "Dumantay", 
            "Liitan", "Manganga", "Poblacion", "Pula", "San Vicente", "Silan", "Tabing Ilog"],
        pola: ["Bagumbayan", "Baras", "Bato", "Boton", "Bugtong na Bato", "Dulongbayan", "Ilog", "Kapatagan", 
            "Masaguitsit", "Mina", "Mundang", "Pagsanjan", "Palahang", "Poblacion", "Tabing Ilog", "Tagumpay"],
        puertogalera: ["Bagumbayan", "Banilad", "Bayanan", "Bongabong", "Buli", "Calapan", "Dulangan", "Katuwiran", 
            "Lagnas", "Mabuhay", "Manatad", "Manuel I", "Panganiban", "Poblacion", "San Antonio", "San Isidro"],
        roxas: ["Antipolo", "Bailan", "Bunga", "Manga", "Manggahan", "Mapagkumbaba", "Poblacion", "San Juan", "Tabon"],
        santeodoro: ["Antipolo", "Bagumbayan", "Bingag", "Buli", "Concepcion", "Dapdap", "Del Pilar", "Katuwiran", 
            "Mahayag", "Magsaysay", "Malinao", "Marakitan", "Poblacion", "San Juan", "Santo Niño"],
        socorro: ["Antipolo", "Batsanga", "Bagumbayan", "Buhay", "Concepcion", "Dolores", "Ibaba", "Kapatagan", 
            "Maguin", "Malalim", "Manatad", "Poblacion", "Pulang Lupa"],
        victoria: ["Bagumbayan", "Baras", "Buli", "Calero", "Cugman", "Del Pilar", "Dulangan", "Ibaba", 
            "Manuel L. Quezon", "Marina", "Nag-Iba", "Nampicuan", "Poblacion"]
    };

    // Populate barangays based on city selection
    const citySelect = document.getElementById('city');
    const barangaySelect = document.getElementById('barangay');

    citySelect.addEventListener('change', function() {
        const selectedCity = this.value;

        // Clear previous barangay options
        barangaySelect.innerHTML = '<option value="" disabled selected>Select your barangay</option>';

        if (barangays[selectedCity]) {
            barangays[selectedCity].forEach(function(barangay) {
                const option = document.createElement('option');
                option.value = barangay;
                option.textContent = barangay;
                barangaySelect.appendChild(option);
            });
        }
    });

    // Calculate age based on birthday
    function calculateAge() {
        const birthdayInput = document.getElementById('birthday');
        const ageInput = document.getElementById('age');
        
        if (birthdayInput.value) {
            const today = new Date();
            const birthDate = new Date(birthdayInput.value);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            ageInput.value = age;
        }
    }
</script>
