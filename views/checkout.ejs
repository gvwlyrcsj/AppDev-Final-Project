<%- include('partials/header') %>

<div class="container py-5" style="max-width: 600px;">
    <div class="card shadow">
        <div class="card-header text-center bg-primary text-white">
            <h3>Receipt</h3>
        </div>
        <div class="card-body p-4">
            <h5 class="text-center mb-4">Thank you for your purchase!</h5>

            <!-- Shipping Address Section -->
            <div class="address-section mb-4">
                <label class="form-label">Shipping Address</label>
                <div class="address-display p-3 border rounded">
                    <span id="selectedAddress">
                        <%= shippingAddress.street_name %>, 
                        <%= shippingAddress.barangay %>, 
                        <%= shippingAddress.city %> - 
                        <%= shippingAddress.zip_code %>
                    </span>
                    <a href="/profile/edit-address" class="btn btn-sm btn-link float-right">Edit Address</a>
                </div>
            </div>

            <% if (cartItems && cartItems.length > 0) { %>
                <form id="checkoutForm" action="/checkout/confirm" method="POST">
                    <table class="table table-borderless">
                        <thead class="border-bottom">
                            <tr>
                                <th>Image</th>
                                <th>Product Name</th>
                                <th class="text-center">Size</th>
                                <th class="text-center">Quantity</th>
                                <th class="text-right">Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% cartItems.forEach(item => { %>
                                <tr>
                                    <td>
                                        <% if (item.imageUrl) { %>
                                            <img src="<%= item.imageUrl %>" alt="<%= item.name %>" style="width: 60px; height: auto;">
                                        <% } else { %>
                                            <span>No image</span>
                                        <% } %>
                                    </td>
                                    <td><%= item.name %></td>
                                    <td class="text-center"><%= item.size %></td>
                                    <td class="text-center"><%= item.quantity %></td>
                                    <td class="text-right">$<%= (item.price * item.quantity).toFixed(2) %></td>
                                </tr>
                            
                                <!-- Hidden Inputs to pass selected item details to the server -->
                                <input type="hidden" name="productId[]" value="<%= item.product_id %>">
                                <input type="hidden" name="size[]" value="<%= item.size %>">
                                <input type="hidden" name="quantity[]" value="<%= item.quantity %>">
                                <input type="hidden" name="price[]" value="<%= item.price %>">
                            <% }); %>
                                                    </tbody>
                    </table>
                
                    <div class="text-center mt-4">
                        <button type="submit" class="btn btn-success">Buy Now</button>
                        <button type="button" class="btn btn-danger" onclick="cancelOrder()">Cancel</button>
                    </div>  
                </form>          
            <% } else { %>
                <div class="text-center">
                    <p>No items to checkout.</p>
                    <a href="/cart" class="btn btn-primary">Return to Cart</a>
                </div>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    
    function cancelOrder() {
        if (confirm("Are you sure you want to cancel this order?")) {
            window.location.href = '/checkout/cancel';
        }
    }
</script>
