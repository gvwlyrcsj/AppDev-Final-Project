<%- include('partials/header') %>

<br><br>

<div class="container">
    <!-- Search bar -->
    <div class="row">
        <div class="col-12 mb-3">
            <input type="text" id="searchBar" placeholder="Search products..." class="form-control" style="width: 300px;">
        </div>
    </div>

    <!-- Product items -->
    <div class="row" id="productList">
        <% product.forEach(product => { %>
            <a href="/product/<%= product.id %>" class="col-lg-4 col-md-6 mb-5 pb-4 d-flex justify-content-center text-decoration-none text-dark product-item">
                <div class="product-content d-flex flex-column align-items-center text-center bg-light rounded py-5 px-4" style="width: 100%; max-width: 300px;">
                    <div class="bg-primary mt-n5 py-3" style="width: 100px;">
                        <h4 class="font-weight-bold text-white mb-0">₱59</h4> <!-- Hardcode price as 50 -->
                    </div>
                    <div class="position-relative bg-primary rounded-circle mt-n3 mb-4 p-4" style="width: 180px; height: 180px;">
                        <img class="rounded-circle w-100 h-100" src="<%= product.imageUrl %>" style="object-fit: cover;">
                    </div>
                    <h5 class="font-weight-bold mb-4 product-name"><%= product.name %></h5>
                </div>
            </a>
        <% }); %>
    </div>
</div>

<%- include('partials/footer') %>

<!-- JavaScript for search -->
<script>
    const searchBar = document.getElementById('searchBar');
    const productList = document.getElementById('productList');

    searchBar.addEventListener('input', function() {
        const searchText = this.value;

        // Send AJAX request to the backend with the correct URL
        fetch(`/product/search?q=${encodeURIComponent(searchText)}`)
            .then(response => response.json())
            .then(products => {
                // Clear current product list
                productList.innerHTML = '';

                // Populate with new search results
                products.forEach(product => {
                    const productHTML = `
                        <a href="/product/${product.id}" class="col-lg-4 col-md-6 mb-5 pb-4 d-flex justify-content-center text-decoration-none text-dark product-item">
                            <div class="product-content d-flex flex-column align-items-center text-center bg-light rounded py-5 px-4" style="width: 100%; max-width: 300px;">
                                <div class="bg-primary mt-n5 py-3" style="width: 100px;">
                                    <h4 class="font-weight-bold text-white mb-0">₱50</h4> <!-- Hardcode price as 50 -->
                                </div>
                                <div class="position-relative bg-primary rounded-circle mt-n3 mb-4 p-4" style="width: 180px; height: 180px;">
                                    <img class="rounded-circle w-100 h-100" src="${product.imageUrl}" style="object-fit: cover;">
                                </div>
                                <h5 class="font-weight-bold mb-4 product-name">${product.name}</h5>
                            </div>
                        </a>
                    `;
                    productList.insertAdjacentHTML('beforeend', productHTML);
                });
            })
            .catch(error => console.error("Error fetching search results:", error));
    });
</script>
